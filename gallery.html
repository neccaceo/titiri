<div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
    <h1 class="text-3xl font-bold text-gray-800 mb-2 px-6 pt-6 sm:px-8 sm:pt-8">ğŸ–¼ï¸ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬</h1>
    <p class="text-gray-600 mb-6 px-6 sm:px-8">
        ì´ë¯¸ì§€ ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ í‘œì‹œí•©ë‹ˆë‹¤.
    </p>

    <div id="loading" class="text-center my-10">
        <div class="loading-spinner mx-auto"></div>
        <p class="text-gray-600 mt-3">ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <div id="error" class="hidden px-6 sm:px-8"></div>

    <div id="swiper-container" class="mt-10 hidden">
        <div class="swiper mySwiper">
            <div class="swiper-wrapper" id="image-container">
            </div>

            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-pagination"></div>
        </div>
    </div>
</div>

<div id="fullScreenModal" class="full-screen-modal">
    <button id="closeModalBtn" class="modal-close-button">&times;</button>
    <img id="fullScreenImage" src="" alt="í™•ëŒ€ ì´ë¯¸ì§€">
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<style>
    .loading-spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid #e5e7eb;
        border-top: 4px solid #2563eb;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .error-message {
        background-color: #fee2e2;
        color: #991b1b;
        padding: 16px;
        border-radius: 8px;
        margin: 20px 0;
    }

    .new-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #ef4444;
        color: white;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        z-index: 10;
    }

    .card-content {
        position: relative;
    }

    .full-screen-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .full-screen-modal.active {
        opacity: 1;
        visibility: visible;
    }

    .full-screen-modal img {
        max-width: 90vw;
        max-height: 90vh;
        object-fit: contain;
        cursor: zoom-out;
    }

    .modal-close-button {
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: none;
        color: white;
        font-size: 2.5rem;
        cursor: pointer;
        z-index: 1001;
    }
</style>

<script>
    const imageContainer = document.getElementById('image-container');
    const loadingDiv = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const swiperContainer = document.getElementById('swiper-container');
    const fullScreenModal = document.getElementById('fullScreenModal');
    const fullScreenImage = document.getElementById('fullScreenImage');
    const closeModalBtn = document.getElementById('closeModalBtn');

    let swiper = null;

    async function loadImages() {
        try {
            loadingDiv.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            swiperContainer.classList.add('hidden');

            // ì ˆëŒ€ ê²½ë¡œ ë˜ëŠ” í˜„ì¬ ìœ„ì¹˜ì˜ ë£¨íŠ¸ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì •
            const response = await fetch('./images.json');
            if (!response.ok) {
                throw new Error('images.jsonì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            const images = await response.json();

            if (!Array.isArray(images) || images.length === 0) {
                throw new Error('ì´ë¯¸ì§€ ëª©ë¡ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
            }

            renderImages(images);
            loadingDiv.classList.add('hidden');
            swiperContainer.classList.remove('hidden');

            if (swiper) {
                swiper.destroy();
            }
            initSwiper();

        } catch (error) {
            loadingDiv.classList.add('hidden');
            errorDiv.classList.remove('hidden');
            errorDiv.innerHTML = `<div class="error-message">
                <strong>ì˜¤ë¥˜:</strong> ${error.message}<br>
                <small>ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ë” ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</small>
            </div>`;
            console.error('ì´ë¯¸ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
        }
    }

    function isNewImage(dateString) {
        if (!dateString) return false;
        const imageDate = new Date(dateString);
        const now = new Date();
        const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
        return imageDate >= oneMonthAgo;
    }

    function renderImages(images) {
        imageContainer.innerHTML = '';

        images.forEach((image, index) => {
            const slide = document.createElement('div');
            slide.className = 'swiper-slide';

            const isNew = isNewImage(image.date);
            const newBadge = isNew ? '<span class="new-badge">NEW</span>' : '';

            slide.innerHTML = `
                <div class="card-content bg-white rounded-lg shadow-md overflow-hidden">
                    ${newBadge}
                    <img src="${image.url}" alt="${image.name || `ì´ë¯¸ì§€ ${index + 1}`}" onerror="this.alt='ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'; this.style.backgroundColor='#f3f4f6';">
                    <div class="p-4">
                        <p class="text-sm text-gray-800 font-semibold truncate" title="${image.name || `ì´ë¯¸ì§€ ${index + 1}`}">
                            <strong>ì´ë¦„:</strong> ${image.name || `ì´ë¯¸ì§€ ${index + 1}`}
                        </p>
                        <p class="text-sm text-gray-600 truncate" title="${image.source || 'ë¯¸ì§€ì •'}">
                            <strong>ì¶œì²˜:</strong> ${image.source || 'ë¯¸ì§€ì •'}
                        </p>
                    </div>
                </div>
            `;

            imageContainer.appendChild(slide);
        });
    }

    function initSwiper() {
        swiper = new Swiper(".mySwiper", {
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: "auto",
            spaceBetween: 40,
            loop: true,
            pagination: {
                el: ".swiper-pagination",
                clickable: true,
            },
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
        });

        swiper.on('click', function(swiper, event) {
            const clickedSlide = event.target.closest('.swiper-slide');
            if (!clickedSlide) return;

            const clickedIndex = swiper.slides.indexOf(clickedSlide);

            if (clickedSlide.classList.contains('swiper-slide-active')) {
                const imageElement = clickedSlide.querySelector('img');
                if (imageElement && imageElement.src) {
                    fullScreenImage.src = imageElement.src;
                    fullScreenModal.classList.add('active');
                }
            } else {
                swiper.slideTo(clickedIndex);
            }
        });
    }

    closeModalBtn.addEventListener('click', () => {
        fullScreenModal.classList.remove('active');
        fullScreenImage.src = '';
    });

    fullScreenModal.addEventListener('click', (event) => {
        if (event.target === fullScreenModal) {
            fullScreenModal.classList.remove('active');
            fullScreenImage.src = '';
        }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
    loadImages();
</script>
